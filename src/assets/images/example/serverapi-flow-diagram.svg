<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 920">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1a1a1a; }
      .subtitle { font: bold 16px sans-serif; fill: #2563eb; }
      .text { font: 15px sans-serif; fill: #374151; }
      .small-text { font: 13px sans-serif; fill: #6b7280; }
      .step { font: bold 16px sans-serif; fill: #dc2626; }
      .box { fill: #f0f9ff; stroke: #2563eb; stroke-width: 2; rx: 8; }
      .server-box { fill: #f0fdf4; stroke: #16a34a; stroke-width: 2; rx: 8; }
      .internal-box { fill: #faf5ff; stroke: #9333ea; stroke-width: 2; rx: 8; }
      .arrow { stroke: #2563eb; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-back { stroke: #16a34a; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); }
      .note-box { fill: #fef3c7; stroke: #f59e0b; stroke-width: 1.5; rx: 4; }
      .highlight { fill: #dbeafe; stroke: #3b82f6; stroke-width: 1; rx: 4; }
      .feature-box { fill: #ecfdf5; stroke: #10b981; stroke-width: 1.5; rx: 4; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2563eb" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#16a34a" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" class="title">serverApi 함수 동작 흐름도</text>
  <text x="400" y="58" text-anchor="middle" class="small-text">(Server Component / Server Action 전용)</text>
  
  <!-- Server Component (Initial) -->
  <rect x="100" y="85" width="600" height="130" class="box"/>
  <text x="400" y="112" text-anchor="middle" class="subtitle">Server Component / Server Action</text>
  <text x="120" y="138" class="text">const { data } = await serverApi('/posts');</text>
  <text x="120" y="160" class="small-text">- Server Component는 기본적으로 서버에서 실행</text>
  <text x="120" y="180" class="small-text">- Next.js 캐싱 옵션 지원 (revalidate, tags)</text>
  <text x="120" y="200" class="small-text">- serverApi('/posts', {method: 'POST'}, {revalidate: 3600})</text>

  <!-- Arrow 1: Call serverApi -->
  <path d="M 400 215 L 400 275" class="arrow"/>
  <rect x="250" y="235" width="300" height="25" class="highlight"/>
  <text x="400" y="255" text-anchor="middle" class="step">① serverApi 함수 호출</text>
  
  <!-- callApi Function -->
  <rect x="100" y="285" width="600" height="140" class="internal-box"/>
  <text x="400" y="312" text-anchor="middle" class="subtitle">callApi 함수 (내부 처리)</text>
  <text x="120" y="338" class="small-text">• apiCallType: 'server' 자동 설정</text>
  <text x="120" y="358" class="small-text">• URL 구성, 헤더 설정, Next.js 캐싱 옵션 병합</text>
  <text x="120" y="378" class="small-text">• fetch() API로 HTTP 요청 실행</text>
  <text x="120" y="398" class="small-text">• 인증 토큰 처리 (Authorization 헤더)</text>
  <text x="120" y="418" class="small-text">• Next.js의 fetch 확장 기능 활용 (캐싱, 재검증)</text>
  
  <!-- Arrow 2: HTTP Request -->
  <path d="M 400 425 L 400 495" class="arrow"/>
  <rect x="260" y="445" width="280" height="25" class="highlight"/>
  <text x="400" y="465" text-anchor="middle" class="step">② HTTP Request (Fetch)</text>
  
  <!-- API Server -->
  <rect x="100" y="505" width="600" height="140" class="server-box"/>
  <text x="400" y="535" text-anchor="middle" class="subtitle">API Server</text>
  <text x="120" y="560" class="text">https://external-api.com 또는 내부 API</text>
  
  <rect x="120" y="580" width="560" height="55" class="note-box"/>
  <text x="140" y="605" class="step">③ 서버 사이드 데이터 처리</text>
  <text x="140" y="625" class="small-text">• DB 조회, 비즈니스 로직 실행, JSON 응답 생성</text>
  
  <!-- Arrow 3: Response -->
  <path d="M 400 645 L 400 715" class="arrow-back"/>
  <rect x="260" y="665" width="280" height="25" class="highlight"/>
  <text x="400" y="685" text-anchor="middle" class="step">④ HTTP Response (JSON)</text>
  
  <!-- Response Processing -->
  <rect x="100" y="725" width="600" height="110" class="internal-box"/>
  <text x="400" y="752" text-anchor="middle" class="subtitle">callApi 응답 처리</text>
  <text x="120" y="778" class="small-text">• response.ok 체크 (상태 코드 확인)</text>
  <text x="120" y="798" class="small-text">• JSON 파싱: response.json()</text>
  <text x="120" y="818" class="small-text">• ApiResponse 형식으로 변환: { success, data, status }</text>
  
  <!-- Arrow 4: Return -->
  <path d="M 400 835 L 400 855" class="arrow-back"/>
  
  <!-- Final Return -->
  <rect x="100" y="865" width="600" height="40" class="feature-box"/>
  <text x="400" y="890" text-anchor="middle" class="text" style="fill: #065f46;">⑤ Server Component로 데이터 반환: { data, status, message }</text>
  
</svg>
