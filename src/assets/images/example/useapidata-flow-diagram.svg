<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 1100">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1a1a1a; }
      .subtitle { font: bold 16px sans-serif; fill: #2563eb; }
      .text { font: 15px sans-serif; fill: #374151; }
      .small-text { font: 13px sans-serif; fill: #6b7280; }
      .step { font: bold 16px sans-serif; fill: #dc2626; }
      .box { fill: #f0f9ff; stroke: #2563eb; stroke-width: 2; rx: 8; }
      .cache-box { fill: #f0fdf4; stroke: #16a34a; stroke-width: 2; rx: 8; }
      .component-box { fill: #fef3c7; stroke: #f59e0b; stroke-width: 2; rx: 8; }
      .arrow { stroke: #2563eb; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-back { stroke: #16a34a; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); }
      .arrow-dashed { stroke: #f59e0b; stroke-width: 2; fill: none; stroke-dasharray: 5,5; marker-end: url(#arrowhead-orange); }
      .note-box { fill: #fef3c7; stroke: #f59e0b; stroke-width: 1.5; rx: 4; }
      .warning-box { fill: #fee2e2; stroke: #dc2626; stroke-width: 2.5; rx: 6; }
      .warning-text { font: bold 14px sans-serif; fill: #dc2626; }
      .highlight { fill: #dbeafe; stroke: #3b82f6; stroke-width: 1; rx: 4; }
      .success-box { fill: #d1fae5; stroke: #10b981; stroke-width: 1.5; rx: 4; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2563eb" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#16a34a" />
    </marker>
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#f59e0b" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" class="title">useApiData 훅 동작 흐름도</text>
  <text x="400" y="58" text-anchor="middle" class="small-text">(TanStack Query 캐시 기반 데이터 읽기)</text>
  
  <!-- Step 1: ComponentA with useApi -->
  <rect x="50" y="85" width="320" height="130" class="box"/>
  <text x="210" y="112" text-anchor="middle" class="subtitle">ComponentA (데이터 생성)</text>
  <text x="70" y="138" class="text">const { data } = useApi('/posts');</text>
  <text x="70" y="160" class="small-text">- API 호출 및 데이터 fetch</text>
  <text x="70" y="180" class="small-text">- enabled: true (기본값)</text>
  <text x="70" y="200" class="small-text">- 자동으로 API 요청 실행</text>

  <!-- Arrow: ComponentA to Cache -->
  <path d="M 210 215 L 210 285" class="arrow"/>
  <rect x="120" y="235" width="180" height="25" class="highlight"/>
  <text x="210" y="255" text-anchor="middle" class="step">① 데이터 저장</text>

  <!-- TanStack Query Cache -->
  <rect x="100" y="295" width="600" height="180" class="cache-box"/>
  <text x="400" y="325" text-anchor="middle" class="subtitle">TanStack Query Cache (메모리)</text>
  
  <rect x="120" y="345" width="560" height="115" class="success-box"/>
  <text x="140" y="370" class="step">② 캐시 저장 완료</text>
  <text x="140" y="392" class="small-text">• queryKey: ['/posts'] 또는 ['/posts', { params }]</text>
  <text x="140" y="412" class="small-text">• data: { posts: [...] } - API 응답 데이터</text>
  <text x="140" y="432" class="small-text">• 다른 컴포넌트에서 같은 queryKey로 접근 가능</text>
  <text x="140" y="452" class="small-text">• 캐시 유효 기간: staleTime, cacheTime 설정에 따라 관리</text>

  <!-- Arrow: Cache to ComponentB -->
  <path d="M 590 295 L 590 255 L 590 215" class="arrow-back"/>
  <rect x="500" y="235" width="180" height="25" class="highlight"/>
  <text x="590" y="255" text-anchor="middle" class="step">③ 캐시 읽기</text>

  <!-- Step 2: ComponentB with useApiData -->
  <rect x="430" y="85" width="320" height="130" class="component-box"/>
  <text x="590" y="112" text-anchor="middle" class="subtitle">ComponentB (데이터 읽기)</text>
  <text x="450" y="138" class="text">const { data } = useApiData('/posts');</text>
  <text x="450" y="160" class="small-text">- 캐시에서 데이터 읽기</text>
  <text x="450" y="180" class="small-text">- enabled: false (기본값)</text>
  <text x="450" y="200" class="small-text">- API 요청 없이 캐시만 확인</text>

  <!-- Warning Box -->
  <rect x="80" y="495" width="640" height="65" class="warning-box"/>
  <text x="400" y="517" text-anchor="middle" class="warning-text">⚠️ 중요: enabled: false 동작 방식 ⚠️</text>
  <text x="400" y="535" text-anchor="middle" class="small-text">캐시에 데이터가 없으면 undefined 반환 (API 요청 하지 않음)</text>
  <text x="400" y="550" text-anchor="middle" class="small-text">캐시에 데이터가 있으면 해당 데이터 반환 (다른 컴포넌트와 공유)</text>

  <!-- useApiData Usage Patterns -->
  <rect x="100" y="580" width="600" height="490" class="box"/>
  <text x="400" y="610" text-anchor="middle" class="subtitle">useApiData 사용 패턴</text>

  <!-- Pattern 1: Cache Read Only -->
  <rect x="120" y="630" width="560" height="80" class="highlight"/>
  <text x="140" y="653" class="step">패턴 1: 캐시 읽기 전용 (기본)</text>
  <text x="140" y="670" class="small-text">const { data } = useApiData('/posts');</text>
  <text x="140" y="687" class="small-text">• 다른 곳에서 useApi로 fetch한 데이터를 읽기만 함</text>
  <text x="140" y="704" class="small-text">• API 호출 없이 캐시에서만 데이터 가져옴</text>

  <!-- Pattern 2: Manual Refetch -->
  <rect x="120" y="720" width="560" height="95" class="highlight"/>
  <text x="140" y="743" class="step">패턴 2: 수동 refetch (버튼 클릭 등)</text>
  <text x="140" y="760" class="small-text">const { data, refetch } = useApiData('/posts');</text>
  <text x="140" y="777" class="small-text">&lt;button onClick={() => refetch()}&gt;새로고침&lt;/button&gt;</text>
  <text x="140" y="794" class="small-text">• 필요할 때만 수동으로 API 호출</text>
  <text x="140" y="811" class="small-text">• refetch() 호출 시 API 요청 → 캐시 업데이트</text>

  <!-- Pattern 3: Conditional Fetch -->
  <rect x="120" y="825" width="560" height="95" class="highlight"/>
  <text x="140" y="848" class="step">패턴 3: 조건부 fetch</text>
  <text x="140" y="865" class="small-text">const { data } = useApiData('/posts', {</text>
  <text x="160" y="882" class="small-text">queryOptions: { enabled: !!userId }  // userId 있을 때만</text>
  <text x="140" y="899" class="small-text">});</text>
  <text x="140" y="916" class="small-text">• enabled 옵션으로 자동 fetch 조건 설정</text>

  <!-- Pattern 4: Initial Data -->
  <rect x="120" y="930" width="560" height="130" class="highlight"/>
  <text x="140" y="953" class="step">패턴 4: 초기 데이터 제공</text>
  <text x="140" y="970" class="small-text">const { data } = useApiData('/posts', {</text>
  <text x="160" y="987" class="small-text">queryOptions: {</text>
  <text x="180" y="1004" class="small-text">initialData: cachedPosts,  // 서버에서 받은 초기 데이터</text>
  <text x="180" y="1021" class="small-text">enabled: shouldRefresh    // 새로고침 조건</text>
  <text x="160" y="1038" class="small-text">}</text>
  <text x="140" y="1055" class="small-text">});</text>

  <!-- Additional Notes -->
  <rect x="100" y="1050" width="600" height="40" class="note-box"/>
  <text x="120" y="1072" class="text" style="fill: #92400e;">※ 핵심: 같은 queryKey를 사용하는 모든 컴포넌트가 캐시를 공유하여 데이터 동기화 자동 유지</text>
  
</svg>
