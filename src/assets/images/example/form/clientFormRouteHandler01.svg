<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 1050">
  <defs>
    <style>
      .title { font: bold 24px sans-serif; fill: #1a1a1a; }
      .subtitle { font: bold 16px sans-serif; fill: #2563eb; }
      .text { font: 15px sans-serif; fill: #374151; }
      .small-text { font: 13px sans-serif; fill: #6b7280; }
      .step { font: bold 16px sans-serif; fill: #dc2626; }
      .box { fill: #f0f9ff; stroke: #2563eb; stroke-width: 2; rx: 8; }
      .server-box { fill: #f0fdf4; stroke: #16a34a; stroke-width: 2; rx: 8; }
      .internal-box { fill: #faf5ff; stroke: #9333ea; stroke-width: 2; rx: 8; }
      .route-handler-box { fill: #fff7ed; stroke: #ea580c; stroke-width: 2; rx: 8; }
      .arrow { stroke: #2563eb; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-back { stroke: #16a34a; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); }
      .note-box { fill: #fef3c7; stroke: #f59e0b; stroke-width: 1.5; rx: 4; }
      .highlight { fill: #dbeafe; stroke: #3b82f6; stroke-width: 1; rx: 4; }
      .feature-box { fill: #ecfdf5; stroke: #10b981; stroke-width: 1.5; rx: 4; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2563eb" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#16a34a" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" class="title">Client Form + Route Handler 흐름도</text>
  <text x="400" y="58" text-anchor="middle" class="small-text">(Client Component + TanStack Query + Route Handler)</text>
  
  <!-- Client Component (Form) -->
  <rect x="100" y="85" width="600" height="130" class="box"/>
  <text x="400" y="112" text-anchor="middle" class="subtitle">Client Component (Form)</text>
  <text x="120" y="138" class="text">const mutation = useApiMutation('/api/form-submit', { method: 'POST' });</text>
  <text x="120" y="160" class="small-text">- 사용자가 Form에 데이터 입력 (id, title, content)</text>
  <text x="120" y="180" class="small-text">- onSubmit 이벤트 발생</text>
  <text x="120" y="200" class="small-text">- mutation.mutate(formData) 호출</text>

  <!-- Arrow 1: Form Submit -->
  <path d="M 400 215 L 400 275" class="arrow"/>
  <rect x="220" y="235" width="360" height="25" class="highlight"/>
  <text x="400" y="255" text-anchor="middle" class="step">① Form Submit → useApiMutation 호출</text>
  
  <!-- useApiMutation (TanStack Query) -->
  <rect x="100" y="285" width="600" height="140" class="internal-box"/>
  <text x="400" y="312" text-anchor="middle" class="subtitle">useApiMutation (TanStack Query)</text>
  <text x="120" y="338" class="small-text">• FormData를 일반 객체로 변환</text>
  <text x="120" y="358" class="small-text">• mutation 상태 관리 (isPending, isSuccess, isError)</text>
  <text x="120" y="378" class="small-text">• baseAxiosClient 통해 HTTP POST 요청 준비</text>
  <text x="120" y="398" class="small-text">• 자동 에러 처리 및 재시도 로직</text>
  <text x="120" y="418" class="small-text">• onSuccess, onError 콜백 실행</text>
  
  <!-- Arrow 2: HTTP Request to Route Handler -->
  <path d="M 400 425 L 400 495" class="arrow"/>
  <rect x="200" y="445" width="400" height="25" class="highlight"/>
  <text x="400" y="465" text-anchor="middle" class="step">② HTTP POST Request (fetch/axios)</text>
  
  <!-- Route Handler -->
  <rect x="100" y="505" width="600" height="140" class="route-handler-box"/>
  <text x="400" y="535" text-anchor="middle" class="subtitle">Route Handler (POST /api/form-submit)</text>
  <text x="120" y="560" class="text">export async function POST(request: NextRequest) { ... }</text>
  <text x="120" y="582" class="small-text">• request.json() 또는 request.formData()로 파싱</text>
  <text x="120" y="602" class="small-text">• FormData → JSON 객체 변환</text>
  <text x="120" y="622" class="small-text">• serverApi 함수 호출 준비</text>

  <!-- Arrow 3: Call serverApi -->
  <path d="M 400 645 L 400 705" class="arrow"/>
  <rect x="250" y="665" width="300" height="25" class="highlight"/>
  <text x="400" y="685" text-anchor="middle" class="step">③ serverApi 함수 호출</text>
  
  <!-- serverApi Internal Processing -->
  <rect x="100" y="715" width="600" height="100" class="internal-box"/>
  <text x="400" y="742" text-anchor="middle" class="subtitle">serverApi 함수 (내부 처리)</text>
  <text x="120" y="768" class="small-text">• URL 구성, 헤더 설정 (Authorization 등)</text>
  <text x="120" y="788" class="small-text">• Next.js 캐싱 옵션 병합 (revalidate, tags)</text>
  <text x="120" y="808" class="small-text">• fetch() API로 외부 API 호출</text>

  <!-- Arrow 4: External API Request -->
  <path d="M 400 815 L 400 875" class="arrow"/>
  <rect x="230" y="835" width="340" height="25" class="highlight"/>
  <text x="400" y="855" text-anchor="middle" class="step">④ HTTP Request (External API)</text>
  
  <!-- External API Server -->
  <rect x="100" y="885" width="600" height="100" class="server-box"/>
  <text x="400" y="915" text-anchor="middle" class="subtitle">External API Server</text>
  <text x="120" y="940" class="text">https://koreanjson.com/todos</text>
  <text x="120" y="965" class="small-text">• 실제 데이터 처리 (DB 저장, 비즈니스 로직 등)</text>

  <!-- Arrow 5: Response Chain Back -->
  <path d="M 650 985 L 650 1015 L 400 1015 L 400 1030" class="arrow-back"/>
  <rect x="200" y="995" width="390" height="25" class="highlight"/>
  <text x="400" y="1015" text-anchor="middle" class="step">⑤ Response: External API → Route Handler → Client</text>
  
  <!-- Final Return -->
  <rect x="100" y="1005" width="90" height="35" class="feature-box"/>
  <text x="145" y="1027" text-anchor="middle" class="text" style="fill: #065f46; font-size: 13px;">결과 반환</text>
  
</svg>
